var q=function(s,c){return s<c?-1:s>c?1:0},L=function(s){return s.reduce(function(c,h){return c+h},0)},T=function(){function s(h){this.colors=h}var c=s.prototype;return c.palette=function(){return this.colors},c.map=function(h){return h},s}(),j=function(){function s(n,t,r){return(n<<10)+(t<<5)+r}function c(n){var t=[],r=!1;function a(){t.sort(n),r=!0}return{push:function(e){t.push(e),r=!1},peek:function(e){return r||a(),e===void 0&&(e=t.length-1),t[e]},pop:function(){return r||a(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return r||a(),t}}}function h(n,t,r,a,e,o,f){var u=this;u.r1=n,u.r2=t,u.g1=r,u.g2=a,u.b1=e,u.b2=o,u.histo=f}function x(){this.vboxes=new c(function(n,t){return q(n.vbox.count()*n.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function y(n,t){if(t.count()){var r=t.r2-t.r1+1,a=t.g2-t.g1+1,e=Math.max.apply(null,[r,a,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var o,f,u,l,b=0,g=[],C=[];if(e==r)for(o=t.r1;o<=t.r2;o++){for(l=0,f=t.g1;f<=t.g2;f++)for(u=t.b1;u<=t.b2;u++)l+=n[s(o,f,u)]||0;g[o]=b+=l}else if(e==a)for(o=t.g1;o<=t.g2;o++){for(l=0,f=t.r1;f<=t.r2;f++)for(u=t.b1;u<=t.b2;u++)l+=n[s(f,o,u)]||0;g[o]=b+=l}else for(o=t.b1;o<=t.b2;o++){for(l=0,f=t.r1;f<=t.r2;f++)for(u=t.g1;u<=t.g2;u++)l+=n[s(f,u,o)]||0;g[o]=b+=l}return g.forEach(function(E,v){C[v]=b-E}),function(E){var v,d,p,w,m,I=E+"1",_=E+"2",z=0;for(o=t[I];o<=t[_];o++)if(g[o]>b/2){for(p=t.copy(),w=t.copy(),m=(v=o-t[I])<=(d=t[_]-o)?Math.min(t[_]-1,~~(o+d/2)):Math.max(t[I],~~(o-1-v/2));!g[m];)m++;for(z=C[m];!z&&g[m-1];)z=C[--m];return p[_]=m,w[I]=p[_]+1,[p,w]}}(e==r?"r":e==a?"g":"b")}}return h.prototype={volume:function(n){var t=this;return t._volume&&!n||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(n){var t=this,r=t.histo;if(!t._count_set||n){var a,e,o,f=0;for(a=t.r1;a<=t.r2;a++)for(e=t.g1;e<=t.g2;e++)for(o=t.b1;o<=t.b2;o++)f+=r[s(a,e,o)]||0;t._count=f,t._count_set=!0}return t._count},copy:function(){var n=this;return new h(n.r1,n.r2,n.g1,n.g2,n.b1,n.b2,n.histo)},avg:function(n){var t=this,r=t.histo;if(!t._avg||n){var a,e,o,f,u=0,l=0,b=0,g=0;if(t.r1===t.r2&&t.g1===t.g2&&t.b1===t.b2)t._avg=[t.r1<<3,t.g1<<3,t.b1<<3];else{for(e=t.r1;e<=t.r2;e++)for(o=t.g1;o<=t.g2;o++)for(f=t.b1;f<=t.b2;f++)u+=a=r[s(e,o,f)]||0,l+=a*(e+.5)*8,b+=a*(o+.5)*8,g+=a*(f+.5)*8;t._avg=u?[~~(l/u),~~(b/u),~~(g/u)]:[~~(8*(t.r1+t.r2+1)/2),~~(8*(t.g1+t.g2+1)/2),~~(8*(t.b1+t.b2+1)/2)]}}return t._avg},contains:function(n){var t=this,r=n[0]>>3;return gval=n[1]>>3,bval=n[2]>>3,r>=t.r1&&r<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},x.prototype={push:function(n){this.vboxes.push({vbox:n,color:n.avg()})},palette:function(){return this.vboxes.map(function(n){return n.color})},size:function(){return this.vboxes.size()},map:function(n){for(var t=this.vboxes,r=0;r<t.size();r++)if(t.peek(r).vbox.contains(n))return t.peek(r).color;return this.nearest(n)},nearest:function(n){for(var t,r,a,e=this.vboxes,o=0;o<e.size();o++)((r=Math.sqrt(Math.pow(n[0]-e.peek(o).color[0],2)+Math.pow(n[1]-e.peek(o).color[1],2)+Math.pow(n[2]-e.peek(o).color[2],2)))<t||t===void 0)&&(t=r,a=e.peek(o).color);return a},forcebw:function(){var n=this.vboxes;n.sort(function(e,o){return q(L(e.color),L(o.color))});var t=n[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(n[0].color=[0,0,0]);var r=n.length-1,a=n[r].color;a[0]>251&&a[1]>251&&a[2]>251&&(n[r].color=[255,255,255])}},{quantize:function(n,t){if(!Number.isInteger(t)||t<1||t>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!n.length||t<2||t>256||!n.length||t<2||t>256)return!1;for(var r=[],a=new Set,e=0;e<n.length;e++){var o=n[e],f=o.join(",");a.has(f)||(a.add(f),r.push(o))}if(r.length<=t)return new T(r);var u=function(v){var d,p=new Array(32768);return v.forEach(function(w){d=s(w[0]>>3,w[1]>>3,w[2]>>3),p[d]=(p[d]||0)+1}),p}(n);u.forEach(function(){});var l=function(v,d){var p,w,m,I=1e6,_=0,z=1e6,k=0,D=1e6,P=0;return v.forEach(function(A){(p=A[0]>>3)<I?I=p:p>_&&(_=p),(w=A[1]>>3)<z?z=w:w>k&&(k=w),(m=A[2]>>3)<D?D=m:m>P&&(P=m)}),new h(I,_,z,k,D,P,d)}(n,u),b=new c(function(v,d){return q(v.count(),d.count())});function g(v,d){for(var p,w=v.size(),m=0;m<1e3;){if(w>=d||m++>1e3)return;if((p=v.pop()).count()){var I=y(u,p),_=I[0],z=I[1];if(!_)return;v.push(_),z&&(v.push(z),w++)}else v.push(p),m++}}b.push(l),g(b,.75*t);for(var C=new c(function(v,d){return q(v.count()*v.volume(),d.count()*d.volume())});b.size();)C.push(b.pop());g(C,t);for(var E=new x;C.size();)E.push(C.pop());return E}}}().quantize,N=function(s){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=s.naturalWidth,this.height=this.canvas.height=s.naturalHeight,this.context.drawImage(s,0,0,this.width,this.height)};N.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var M=function(){};M.prototype.getColor=function(s,c){return c===void 0&&(c=10),this.getPalette(s,5,c)[0]},M.prototype.getPalette=function(s,c,h){var x=function(r){var a=r.colorCount,e=r.quality;if(a!==void 0&&Number.isInteger(a)){if(a===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");a=Math.max(a,2),a=Math.min(a,20)}else a=10;return(e===void 0||!Number.isInteger(e)||e<1)&&(e=10),{colorCount:a,quality:e}}({colorCount:c,quality:h}),y=new N(s),n=function(r,a,e){for(var o,f,u,l,b,g=r,C=[],E=0;E<a;E+=e)f=g[0+(o=4*E)],u=g[o+1],l=g[o+2],((b=g[o+3])===void 0||b>=125)&&(f>250&&u>250&&l>250||C.push([f,u,l]));return C}(y.getImageData().data,y.width*y.height,x.quality),t=j(n,x.colorCount);return t?t.palette():null},M.prototype.getColorFromUrl=function(s,c,h){var x=this,y=document.createElement("img");y.addEventListener("load",function(){var n=x.getPalette(y,5,h);c(n[0],s)}),y.src=s},M.prototype.getImageData=function(s,c){var h=new XMLHttpRequest;h.open("GET",s,!0),h.responseType="arraybuffer",h.onload=function(){if(this.status==200){var x=new Uint8Array(this.response);i=x.length;for(var y=new Array(i),n=0;n<x.length;n++)y[n]=String.fromCharCode(x[n]);var t=y.join(""),r=window.btoa(t);c("data:image/png;base64,"+r)}},h.send()},M.prototype.getColorAsync=function(s,c,h){var x=this;this.getImageData(s,function(y){var n=document.createElement("img");n.addEventListener("load",function(){var t=x.getPalette(n,5,h);c(t[0],this)}),n.src=y})};export{M as default};
